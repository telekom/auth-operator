apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
- manifests.yaml
- namespace_webhooks.yaml
- service.yaml
- secret.yaml
- deployment.yaml

configurations:
- kustomizeconfig.yaml

# Add the component label to the auto-generated ValidatingWebhookConfiguration
# (manifests.yaml is generated by controller-gen and cannot carry custom labels).
# Use strategic merge patch to preserve existing labels while adding our own.
patches:
- target:
    kind: ValidatingWebhookConfiguration
    name: validating-webhook-configuration
  patch: |
    apiVersion: admissionregistration.k8s.io/v1
    kind: ValidatingWebhookConfiguration
    metadata:
      name: validating-webhook-configuration
      labels:
        authorization.t-caas.telekom.com/component: "webhook"
